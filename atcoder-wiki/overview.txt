2025.12.08
React  + TypeScript + Go によるAtCoder向けのアルゴリズムWiki

【構成】
React + TypeScript
　=> Vite を使用
Go
　=> Gin と GORM を使用
Database
　=> Dockerコンテナ内にPostgreSQLを建てる


【開発環境の確認コマンド】
go version
node -v
npm -v
git --version
docker --version
docker compose version


【コマンド実行結果】
go version go1.25.1 darwin/arm64
v22.17.1
10.9.2
git version 2.52.0
Docker version 28.5.1, build e180ab8
Docker Compose version v2.40.2-desktop.1



【実装機能】
・ページの作成、編集、削除が可能 
・マークダウン形式で記述ができる（ページの最初は必ず見出し１とする。 
・リンクは自動的にタイトル（見出し１）の頭文字をソートして表示される。


【画面概要】
[ Topページ ] 
　=> 各アルゴリズムへのリンク集（リンク先ページへ遷移） 
　=> 新規ページ作成ボタン（新期ページ作成ページへ遷移）

[ リンク先ページ ] 
　=> マークダウン形式で記録（Qiitaみたいな感じ） 

[ 新期ページ作成ページ ] 
　=> 新期ページの作成



========================================================================================================================
【開発手順】
▶ ステップ1：リポジトリ作成 & 初期構成
mkdir wiki-app
cd wiki-app
mkdir backend frontend




▶ ステップ2：PostgreSQL を Docker で立てる
touch docker-compose.yml

中身（このままコピペでOK）
version: "3.9"

services:
  db:
    image: postgres:16
    container_name: wiki-postgres
    restart: always
    environment:
      POSTGRES_USER: wikiuser
      POSTGRES_PASSWORD: wikipass
      POSTGRES_DB: wiki
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:

起動：
docker compose up -d

確認：
docker ps
　=> 5432ポートにバインド（localhost:5432）




▶ ステップ3：実装（バックエンド）
3-1. GoからDBへの接続確認
　-> Step 1：backend 側を Go Modules 初期化
　　　cd backend
　　　go mod init atcoder-wiki-backend

　-> Step 2：PostgreSQL ドライバ（pgx）を導入
　　　go get github.com/jackc/pgx/v5

　-> Step 3：接続テスト用 main.go を作成
　　　
　-> Step 4：接続確認
　　　go run main.go

✅ PostgreSQL 接続成功
現在時刻: 2025-01-08 21:34:12.123456+09




▶ ステップ4：DBスキーマ確定
docker exec -it wiki-postgres psql -U wikiuser -d wiki

wiki=# となり、コンテナに入ったら以下を実行。
-------------------
CREATE TABLE pages (
    id          SERIAL PRIMARY KEY,
    slug        TEXT NOT NULL UNIQUE,
    title       TEXT NOT NULL,
    content_md  TEXT NOT NULL,
    created_at  TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at  TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);
-------------------

確認：
\d pages




▶ ステップ5：Web API化
　-> Step 1：Gin 導入
　　　go get -u github.com/gin-gonic/gin

　-> Step 2：main.goをWeb サーバ用に書き換え（PostgreSQLとの接続確認用のmain.goは_main.goにリネームした）

　-> Step 3：サーバ起動確認
　　　go run main.go
　　*別ターミナルで：
　　　curl http://localhost:8080/health

接続成功：
{"status":"ok"}




▶ ステップ5：各種API実装
　-> Step 1：Page モデルを作成
　　　backend/model/page.go を作成

　-> Step 2：DBへの問い合わせ関数を作る（repository層）
　　　backend/repository/page_repository.go を作成

　-> Step 3：
　　　backend/handler/page_handler.go を作成

　-> Step 4：
　　　main.go にルーティング追加

　-> Step 5：APIテスト
　　　go run main,go
　　*別ターミナルで：
　　　curl http://localhost:8080/api/pages

接続成功：
[ ] が返れば成功。（まだレコードがないため）




▶ ステップ5：新規ページ作成APIを作成
　-> Step 1：リクエスト用 DTO を作る
　　　backend/handler/page_handler.go に追記

　-> Step 2：Repository に INSERT 関数を追加
　　　backend/repository/page_repository.go に追記

　-> Step 3：slug 生成関数を追加（handler側）
　　　backend/handler/page_handler.go に関数を追加

　-> Step 4：POST ハンドラを追加
　　　page_handler.go に追記

　-> Step 5：ルーティング追加（main.go）

動作確認
　サーバ再起動
　　go run main.go

　POST テスト（1件登録）
　　curl -X POST http://localhost:8080/api/pages \
　　  -H "Content-Type: application/json" \
　　  -d '{
  　　  "title": "BFS 基本",
  　　  "content_md": "# BFS 基本\n\n幅優先探索の基本まとめ"
  　　}'
  
  　一覧に反映されたか確認
  　　curl http://localhost:8080/api/pages



  
▶ ステップ6：詳細取得APIを実装
　-> Step 1：Repository に「slug で1件取得」関数を追加
　　　backend/repository/page_repository.go に 追記

　-> Step 2：Handler に詳細取得ハンドラを追加
　　　backend/handler/page_handler.go に 追記

　-> Step 3：ルーティング追加（main.go）

動作確認
　サーバ再起動
　　go run main.go
　curl http://localhost:8080/api/pages/bfs





▶ ステップ7：更新APIを実装（編集）
　-> Step 1：Repository に UPDATE 関数を追加
　　　backend/repository/page_repository.go に追記

　-> Step 2：Handler に PUT 用 DTO と処理を追加
　　　backend/handler/page_handler.go に追記

　-> Step 3：ルーティング追加（main.go）

動作確認（編集）
　サーバ再起動
　　go run main.go
　curl -X PUT http://localhost:8080/api/pages/1 \
  　-H "Content-Type: application/json" \
  　-d '{
  　  "title": "BFS 基本（更新）",
  　  "content_md": "# BFS 基本（更新）\n\n内容を更新しました"
  　}'




▶ ステップ8：削除APIを実装
　-> Step 1：Repository に DELETE 関数を追加
　　　backend/repository/page_repository.go に追記

　-> Step 2：Handler に DELETE 処理を追加
　　　backend/handler/page_handler.go に追記

　-> Step 3：ルーティング追加（main.go）

動作確認（編集）
　サーバ再起動
　　go run main.go
　curl -X DELETE http://localhost:8080/api/pages/1




▶ ステップ9：ロギング機能を実装
　-> Step 1：ログ出力用ディレクトリを作成およびログ出力用ファイル
　　　cd backend
　　　mkdir logs
　　　touch logs/access.log
　　　touch logs/error.log
　　　touch logs/security.log

　-> Step 2：共通 Logger を作成
　　　backend/logger/logger.go を作成

　-> Step 3：アクセスログ Middleware（全APIのアクセスが必ず access.log に残る）
　　　backend/middleware/access_logger.go を作成

　-> Step 4：不正リクエスト & セキュリティログ
　　　backend/middleware/security_logger.go を作成

　-> Step 5：Gin の Recovery をエラーログに接続
　　　main.go を ログ対応版に差し替え

　-> Step 6：編集・削除の失敗ログを追加（handler）
　　　page_handler.go の Update / Delete のエラー箇所だけ修正

動作確認方法
　正常アクセス → access.log
　　curl http://localhost:8080/api/pages
　　tail -f logs/access.log

　不正アクセス → security.log
　　curl http://localhost:8080/api/unknown
　　tail -f logs/security.log

　編集失敗 → error.log
　　curl -X PUT http://localhost:8080/api/pages/999
　　tail -f logs/error.log







